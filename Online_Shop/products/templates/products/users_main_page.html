<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Featured Products - Your Online Shop</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1bPj/Z3L1oJ4aI9nLEHjpUnhsOuSf9oq70nNmj+oCMsZ6d4zjpPG2OvrXX3Z3ddcJrFZ+tMYhsX2X8ZHm+/z5Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            background-color: lightcyan; /* changed to light cyan */
            color: #000; /* changed to black */
            margin: 0;
            padding: 0;
        }

        #carouselExample {
            width: 100%;
        }

        .product-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            flex-wrap: wrap;
        }

        .product-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 10px;
            background-color: lightblue;
        }

        .product-image {
            width: 100px;
            height: 100px;
        }

        .product-name {
            font-size: 18px;
            margin-top: 10px;
        }

        .product-price {
            font-size: 16px;
            color: #888;
        }

        .product-description {
            font-size: 14px;
            color: #555;
            margin-top: 5px;
        }

        .product-actions {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
    
        .add-button {
            background-color: blue;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
        }
    
        .quantity-wrapper {
            display: none;
            align-items: center;
            margin-left: 10px;
        }
    
        .quantity-button {
            background-color: blue;
            color: white;
            border: none;
            padding: 5px 5px;
            border-radius: 5px;
            cursor: pointer;
        }
    
        .quantity-input {
            width: 40px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 0 5px;
        }
        footer {
            background-color: grey;
            padding: 20px 0;
            text-align: center;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .about-me, .contact-info {
            {% comment %} display: flex; {% endcomment %}
            flex: 3;
        }
        
        .about-me h3, .contact-info h3 {
            color: #333;
        }
        
        .contact-info ul {
            list-style: none;
            padding: 0;
        }
        
        .contact-info ul li {
            margin-bottom: 10px;
            color: #666;
        }
        
        .contact-info ul li i {
            margin-right: 5px;
        }
        .contact-info ul li i {
            margin-right: 5px;
        }
        
        /* Style specific icons */
        .fab.fa-whatsapp { color: green; }
        .fab.fa-telegram { color: #0088cc; }
        .fab.fa-instagram { color: #833ab4; }
        /* Animation for glow effect */
        @keyframes glow {
        0% {
            opacity: 0.5;
            box-shadow: 0 0 10px 5px rgba(0, 0, 255, 0.5);
        }
        50% {
            opacity: 1;
            box-shadow: 0 0 20px 10px rgba(0, 0, 255, 0.5);
        }
        100% {
            opacity: 0.5;
            box-shadow: 0 0 10px 5px rgba(0, 0, 255, 0.5);
        }
        }

        /* Animation for wave effect */
        @keyframes wave {
        0% {
            transform: scaleX(1);
        }
        50% {
            transform: scaleX(1.2);
        }
        100% {
            transform: scaleX(1);
        }
        }

        /* Apply the animations to the placeholders */
        .placeholder-glow .placeholder {
        animation: glow 2s infinite alternate;
        }

        .placeholder-wave .placeholder {
        display: inline-block;
        overflow: hidden;
        white-space: nowrap;
        position: relative;
        }

        .placeholder-wave .placeholder:before {
        content: attr(data-content);
        overflow: hidden;
        white-space: nowrap;

        width: 100%;
        left: 0;
        top: 0;
        animation: wave 1s infinite;
        }
            /* styles.css */
    .cookie-consent {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px;
        background-color: grey; /* Transparent background */
        color: #fff; /* White text */
    }

    .cookie-consent p {
        margin-right: 10px;
    }

    .cookie-consent__btn {
        background-color: lightcyan;
        color: black;/* Blue color */
        border: 1px solid #3498db; /* Blue border */
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
    }

    .cookie-consent__btn:hover {
        background-color: #3498db; /* Blue hover color */
        color: #fff; /* White text on hover */
    }

      body {
        position: relative;
        margin: 0;
        padding: 0;
    }
    
    #shopping-cart {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #007bff;
        color: #fff;
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: red;
        color: #fff;
        border-radius: 100%;
        padding: 3px 6px;
        font-size: 12px;
    }
      .container1 {
        width: 1000px;
        margin: auto;
        transition: 0.5s;
      }
      .list {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        column-gap: 20px;
        row-gap: 20px;
        margin-top: 50px;
      }
      .list .item {
        text-align: center;
        background-color: #dce0e1;
        padding: 20px;
        box-shadow: 0 50px 50px #757676;
        letter-spacing: 1px;
      }
      .list .item img {
        width: 12rem;
        height: 12rem;
      }
      .list .item .title {
        font-weight: 600;
        padding: 1rem 0rem 1rem 0rem;
      }
      .list .item .price {
        margin: 10px;
      }
      .list .item button {
        background-color: #1c1f25;
        color: #fff;
        width: 100%;
        padding: 10px;
      }
      .card {
        position: fixed;
        top: 0;
        left: 100%;
        width: 500px;
        background-color: #453e3b;
        height: 100vh;
        transition: 0.5s;
      }
      .active .card {
        left: calc(100% - 500px);
      }
      .active .container {
        transform: translateX(-200px);
      }
      .card h1 {
        color: #e8bc0e;
        font-weight: 100;
        margin: 0;
        padding: 0 20px;
        height: 80px;
        display: flex;
        align-items: center;
      }
      .card .checkOut {
        position: absolute;
        bottom: 0;
        width: 100%;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
      }
      .card .checkOut div {
        background-color: #e8bc0e;
        width: 100%;
        height: 70px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        cursor: pointer;
      }
      .card .checkOut div:nth-child(2) {
        background-color: #1c1f25;
        color: #fff;
      }
      .listCard li {
        display: grid;
        grid-template-columns: 100px repeat(3, 1fr);
        color: #fff;
        row-gap: 10px;
      }
      .listCard li div {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .listCard li img {
        width: 4rem;
        height: 4rem;
      }
      .listCard li button {
        background-color: #fff5;
        border: none;
      }
      .listCard .count {
        margin: 0 10px;
      }
      .checkOutInCart {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 6rem;
      }
      .checkOutInCart > button {
        padding: 1.15rem 4rem 1.15rem 4rem;
        background-color: #007bff;
        outline: none;
        border: none;
        border-radius: 0.875rem;
        color: white;
        margin: auto;
      }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">{{ user.email }}</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item"><a class="nav-link" onclick="location.href='{% url 'products:logged_in_main_page' %}'">Home</a></li>
            <li class="nav-item"><a class="nav-link" onclick="location.href='{% url 'users:profile' username=user.username %}'">Account</a></li>
            <li class="nav-item"><a class="nav-link" onclick="location.href='{% url 'products:category-products' %}'">Categories</a></li>
        </ul>
        <a class="nav-link" onclick="location.href='{% url 'products:search' %}'"><img src="../../media/searching-bar.png" alt="search" style="width: 50px;"></a>     <!-- Search form -->
</nav>
    <!-- Carousel of project pictures -->
    <div id="carouselExample" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
            <!-- Add your project pictures here -->
            <div class="carousel-item active">
                <img src="https://via.placeholder.com/1200x400.png?text=Project+1" class="d-block w-100" alt="Project 1">
            </div>
            <div class="carousel-item">
                <img src="https://via.placeholder.com/1200x400.png?text=Project+2" class="d-block w-100" alt="Project 2">
            </div>
            <!-- Add more carousel items as needed -->
        </div>
    </div>
    {% comment %} {%for product in products%} {% endcomment %}
<section id="categories" class="container mt-4" >
    {% for category in categories %}
        <div class="category">
            <h3 class="placeholder-glow">
                <span class="placeholder col-12">{{ category.name }}</span>
            </h3>
            {% load static %}
        </div>
        <div class="goz" style="display:flex ;flex-direction: row;">
            {% for product in category.products.all %}
                <div class="product-box" style="align-items: center;">
                    <a style="text-align: center;" onclick="location.href='{% url 'products:product_detail' product.slug %}'">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
                        {% else %}
                            <img src="{% static 'images/default_product_image.jpg' %}" alt="Default Image" class="product-image">
                        {% endif %}
                        <h3 class="product-name">{{ product.name }}</h3>
                        <p class="product-price">${{ product.price }}</p>
                        <p class="product-description">{{ product.description }}</p>
                    </a>
                    <div class="product-actions">
                        <button class="add-button">Add to Cart</button>
                        <div class="quantity-wrapper">
                            <button class="quantity-button decrement">-</button>
                            <input type="text" class="quantity-input" value="1" readonly>
                            <button class="quantity-button increment">+</button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endfor %}
    <div id="shopping-cart">
        <i class="fas fa-shopping-cart"><img src="../../media/shopping-cart.png" alt="Icon description" style="width: 50px;"></i>
        <span class="notification-badge">0</span>
    </div>
</section>
<section style="margin: 10vh;">
    <div class="container1" >
        <div class="list"></div>
      </div>
      <div class="card">
        <h1>Card</h1>
        <ul class="listCard"></ul>
        <!-- <div class="checkOutInCart">
            <button onclick="checkout()">Checkout</button>
        </div> -->
        <div class="checkOut">
          <a id="checkout-link" onclick="checkout()"><div class="total">0</div></a>
          <div class="closeShopping">Close</div>
        </div>
      </div>
</section>  
    </section>        
    <footer>
        <div class="footer-content" style="justify-content: space-between;">
            <div class="about-me">
                <h3>About Me</h3>
                <p> lorem ispum Lorem ipsum dolor sit amet,
                     consectetur adipiscing elit. Sed nec nisi id risus consequat malesuada. Nulla facilisi.
                      Phasellus malesuada dui ut odio malesuada feugiat. Donec in est in sapien cursus fermentum.
                       Maecenas vitae ante eu magna convallis pharetra. 
            <div class="contact-info">
                <h3>Contact Info</h3>
                <ul>
                    <li><i class="fas fa-phone"></i> Phone: 123-456-7890</li>
                    <li><i class="fab fa-whatsapp"></i> WhatsApp: 123-456-7890</li>
                    <li><i class="fab fa-telegram"></i> Telegram: @yourtelegramusername</li>
                    <li><i class="fab fa-instagram"></i> Instagram: @yourinstagramusername</li>
                    <!-- Add more contact information if needed -->
                </ul>
            </div>
        </div>
    </footer>

    <footer class="text-center py-3">
        <p>&copy; 2024 Your Online Shop. All rights reserved.</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        const addButtons = document.querySelectorAll('.add-button');
        const incrementButtons = document.querySelectorAll('.increment');
        const decrementButtons = document.querySelectorAll('.decrement');
        const quantityInputs = document.querySelectorAll('.quantity-input');
        const quantityWrappers = document.querySelectorAll('.quantity-wrapper');
        const notificationBadge = document.querySelector('.notification-badge');
        
        // Initialize notification count
        let notificationCount = 0;
        notificationBadge.textContent = notificationCount;
        
        // Event listener for Add to Cart buttons and increment/decrement buttons
        for (let i = 0; i < addButtons.length; i++) {
            addButtons[i].addEventListener('click', () => {
                addButtons[i].style.display = 'none';
                quantityWrappers[i].style.display = 'flex';
                
                // Increase notification count when Add to Cart is clicked
                notificationCount++;
                updateNotificationBadge();
            });
        
            incrementButtons[i].addEventListener('click', () => {
                quantityInputs[i].value = parseInt(quantityInputs[i].value) + 1;
                
                // Increase notification count when increment button is clicked
                notificationCount++;
                updateNotificationBadge();
            });
        
            decrementButtons[i].addEventListener('click', () => {
                const currentValue = parseInt(quantityInputs[i].value);
        
                if (currentValue > 1) {
                    quantityInputs[i].value = currentValue - 1;
                } else {
                    addButtons[i].style.display = 'block';
                    quantityWrappers[i].style.display = 'none';
                }
                
                // Decrease notification count when decrement button is clicked
                notificationCount--;
                updateNotificationBadge();
            });
        }
        
        // Function to update the notification badge
        function updateNotificationBadge() {
            notificationBadge.textContent = notificationCount;
        }
        
    function acceptCookies() {
        document.getElementById('cookieConsent').style.display = 'none';
        // Set a cookie to remember that the user has accepted cookies
        document.cookie = "cookie_consent_accepted=true; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/";
    }// Define variables for cart count
    let openShopping = document.querySelector("#shopping-cart");
    let closeShopping = document.querySelector(".closeShopping");
    let list = document.querySelector(".list");
    let listCard = document.querySelector(".listCard");
    let body = document.querySelector("body");
    let total = document.querySelector(".total");
    let quantity = document.querySelector(".quantity");
    
    openShopping.addEventListener("click", () => {
        body.classList.add("active");
    });
    closeShopping.addEventListener("click", () => {
        body.classList.remove("active");
    });
    
    let products = [];
    let listCards = [];
    const fetchProducts = async () => {
        await fetch("http://127.0.0.1:8000/api/products/list/?format=json")
            .then((response) => response.json())
            .then((data) => {
                //
                products = data;
                //
                if (JSON.parse(localStorage.getItem("shoppingCart"))) {
                    JSON.parse(localStorage.getItem("shoppingCart")).forEach(
                        (item) => {
                            let product = products.find(
                                (prod) => Number(prod.id) == Number(item.id)
                            );
                            if (product) {
                                console.log(product);
                                let newDiv = document.createElement("li");
                                newDiv.innerHTML = `
                                    <div><img src="http://127.0.0.1:8000/${
                                    product.image
                                    }"/></div>
                                    <div>${product.name}</div>
                                    <div>$${product.price.toLocaleString()}</div>
                                    <div>
                                        <button onclick="changeQuantity(${item.id}, ${
                                    item.quantity - 1
                                    })">-</button>
                                        <div class="count">${item.quantity}</div>
                                        <button onclick="changeQuantity(${item.id}, ${
                                    item.quantity + 1
                                    })">+</button>
                                    </div>`;
                                listCard.appendChild(newDiv);
                            }
                        }
                    );
                }
                initApp();
            })
            .catch((error) => {
                console.error("Error fetching products:", error);
            });
    };
    fetchProducts();
    
    function initApp() {
        products.forEach((value, key) => {
            let newDiv = document.createElement("div");
            newDiv.classList.add("item");
            newDiv.innerHTML = `
                <img src="http://127.0.0.1:8000/${value.image}">
                <div class="title">${value.name}</div>
                <div class="price">$${value.price.toLocaleString()}</div>
                <button onclick="addToCard(${value.id})">Add To Card</button>`;
            list.appendChild(newDiv);
        });
    }
    
    function addToCard(id) {
        if (!listCards.find((item) => item.id == id)) {
            // copy product form list to list card
            let productItem = products.find((product) => product.id == id);
            productItem["quantity"] = 1;
            listCards.push(productItem);
        }
        if (!localStorage.getItem("shoppingCart")) {
            localStorage.setItem(
                "shoppingCart",
                JSON.stringify([{ id, quantity: 1 }])
            );
        }
        if (JSON.parse(localStorage.getItem("shoppingCart"))) {
            if (JSON.parse(localStorage.getItem("shoppingCart")).length > 0) {
                if (
                    !JSON.parse(localStorage.getItem("shoppingCart")).find(
                        (item) => item.id == id
                    )
                ) {
                    localStorage.setItem(
                        "shoppingCart",
                        JSON.stringify([
                            ...JSON.parse(localStorage.getItem("shoppingCart")),
                            { id, quantity: 1 },
                        ])
                    );
                }
            } else {
                localStorage.setItem(
                    "shoppingCart",
                    JSON.stringify([{ id, quantity: 1 }])
                );
            }
        }
        reloadCard();
    }
    
    function reloadCard() {
        listCard.innerHTML = "";
        let count = 0;
        let totalPrice = 0;
        listCards.forEach((value) => {
            totalPrice = totalPrice + value.price;
            count = count + value.quantity;
            if (value != null) {
                let newDiv = document.createElement("li");
                newDiv.innerHTML = `
                    <div><img src="http://127.0.0.1:8000/${value.image}"/></div>
                    <div>${value.name}</div>
                    <div>$${value.price.toLocaleString()}</div>
                    <div>
                        <button onclick="changeQuantity(${value.id}, ${
                    value.quantity - 1
                    })">-</button>
                        <div class="count">${value.quantity}</div>
                        <button onclick="changeQuantity(${value.id}, ${
                    value.quantity + 1
                    })">+</button>
                    </div>`;
                listCard.appendChild(newDiv);
            }
        });
        total.innerText = totalPrice.toLocaleString();
        quantity.innerText = count;
    }
    
    function changeQuantity(id, quantity) {
        console.log(listCards);
        if (quantity == 0) {
            listCards = listCards.filter((item) => item.id != id);
            newLocalStorage = [
                ...JSON.parse(localStorage.getItem("shoppingCart")).filter(
                    (item) => item.id != id
                ),
            ];
            if (newLocalStorage.length == 0) {
                localStorage.removeItem("shoppingCart");
            } else {
                localStorage.setItem(
                    "shoppingCart",
                    JSON.stringify(newLocalStorage)
                );
            }
        } else {
            listCards[listCards.findIndex((item) => item.id == id)].quantity =
                Number(quantity);
            listCards[listCards.findIndex((item) => item.id == id)].price =
                Number(quantity) * products.find((item) => item.id == id).price;
            if (!localStorage.getItem("shoppingCart")) {
                localStorage.setItem(
                    "shoppingCart",
                    JSON.stringify([{ id, quantity: quantity }])
                );
            } else {
                localStorage.setItem(
                    "shoppingCart",
                    JSON.stringify([
                        ...JSON.parse(localStorage.getItem("shoppingCart")).filter(
                            (item) => item.id != id
                        ),
                        { id, quantity: quantity },
                    ])
                );
            }
        }
        reloadCard();
    }
    
    // Checkout Functionality
    let checkOutButton = document.querySelector('.checkOut');

    async function checkout() {
        if (localStorage.getItem('shoppingCart') && JSON.parse(localStorage.getItem('shoppingCart')).length > 0) {
            // Retrieve the CSRF token from the cookie
            const csrftoken = getCookie('csrftoken');
    
            await fetch("http://127.0.0.1:8000/orders/api/order-item-creator/", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    // Include the CSRF token in the headers
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify(JSON.parse(localStorage.getItem('shoppingCart')))
            });
        }
    }
    
    // Function to retrieve the CSRF token from the cookie
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    checkOutButton.addEventListener('click', checkout);
    
    </script>
</body>
</html>